---
title: "MCU Modeling"
author: "Joshue Fuentes"
date: "2025-07-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# Loading  packages
library(dplyr)
library(tidyr)
library(ggplot2)
library(caret)

mcu_scores <- read_csv("C:/Users/joshu/Downloads/mcu_scores.csv")
comics <- read_csv("C:/Users/joshu/Downloads/comics.csv")
comic_to_movie <- read_csv("C:/Users/joshu/Downloads/comic_to_movie.csv")
characters_in_movies <- read_csv("C:/Users/joshu/Downloads/characters_in_movies.csv")
marvel_characters <- read_csv("C:/Users/joshu/Downloads/marvel_characters.csv")
characters_in_teams <- read_csv("C:/Users/joshu/Downloads/characters_in_teams.csv")
teams <- read_csv("C:/Users/joshu/Downloads/teams.csv")

unique(comic_to_movie$movie_id)
```

```{r}
dim(comic_to_movie)


# Count unique movies in the table
n_unique_movies <- length(unique(comic_to_movie$movie_id))
print(paste("Unique movies in comic_to_movie:", n_unique_movies))

# See which movies have comic connections
movies_with_connections <- comic_to_movie %>%
  group_by(movie_id) %>%
  summarise(comic_count = n()) %>%
  left_join(mcu_scores, by = c("movie_id" = "id")) %>%
  select(movie_id, title, comic_count) %>%
  arrange(desc(comic_count))

print(movies_with_connections)
```


```{r}
movies_list <- comic_to_movie %>%
  distinct(movie_id) %>%
  left_join(mcu_scores, by = c("movie_id" = "id")) %>%
  select(movie_id, title)

movies_list

# Comic theme features 
comic_features <- comic_to_movie %>%
  left_join(comics, by = "comic_id") %>%
  group_by(movie_id) %>%
  summarise(
    comic_count = n(),
    has_mentor = any(mentor == 1, na.rm = TRUE),
    has_romance = any(romance == 1, na.rm = TRUE),
    has_comedy = any(comedy == 1, na.rm = TRUE)
  )

# Character features (best correlations)
character_features <- characters_in_movies %>%
  filter(movie_id %in% movies_list$movie_id) %>%
  group_by(movie_id) %>%
  summarise(
    total_characters = n()
  )

# Team features  
team_features <- characters_in_movies %>%
  filter(movie_id %in% movies_list$movie_id) %>%
  left_join(characters_in_teams, by = "character_id", relationship = "many-to-many") %>%
  left_join(teams, by = "team_id") %>%
  group_by(movie_id) %>%
  summarise(
    has_avengers = any(grepl("Avengers", team_name, ignore.case = TRUE), na.rm = TRUE)
  )

# Combining everything
final_data <- movies_list %>%
  left_join(mcu_scores, by = c("movie_id" = "id")) %>%
  left_join(comic_features, by = "movie_id") %>%
  left_join(character_features, by = "movie_id") %>%
  left_join(team_features, by = "movie_id") %>%
  mutate(
    high_success = factor(critic_score > 80 | audience_score > 85,
                         levels = c(FALSE, TRUE),
                         labels = c("No", "Yes"))
  ) %>%
  select(title.x, high_success, comic_count, has_mentor, has_romance, 
         has_comedy, total_characters, has_avengers) %>%
  rename(title = title.x)

# Checking data
dim(final_data)
final_data

# Trying Best models
control <- trainControl(method = "LOOCV")

# Model 1: Total characters (highest correlation)
model1 <- train(
  high_success ~ total_characters,
  data = final_data,
  method = "glm",
  family = "binomial",
  trControl = control
)

model1

# Model 2: Characters + Avengers
model2 <- train(
  high_success ~ total_characters + has_avengers,
  data = final_data,
  method = "glm",
  family = "binomial",
  trControl = control
)

model2

# Model 3: Themes approach
model3 <- train(
  high_success ~ has_mentor + has_romance + has_comedy,
  data = final_data,
  method = "glm",
  family = "binomial",
  trControl = control
)

model3

# Compare results
results <- data.frame(
  Model = c("Total Characters", "Characters + Avengers", "Comic Themes"),
  Accuracy = c(model1$results$Accuracy, model2$results$Accuracy, model3$results$Accuracy),
  Kappa = c(model1$results$Kappa, model2$results$Kappa, model3$results$Kappa)
)

results %>% arrange(desc(Kappa))
```


```{r}
final_summary <- final_data %>%
  select(title, high_success, total_characters, has_avengers) %>%
  arrange(desc(high_success), desc(total_characters))

print("Best Kappa Score: 0.0299 (slightly better than random chance)")
print("Best Features: Total Characters in Movie")

final_summary
```


```{r}
ggplot(final_data, aes(x = total_characters, y = as.numeric(high_success) - 1, color = has_avengers)) +
  geom_point(size = 3) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE) +
  labs(title = "MCU Movie Success vs. Character Count",
       x = "Total Characters in Movie",
       y = "Probability of High Success",
       color = "Has Avengers") +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 1))

# Final insights
insights <- final_data %>%
  group_by(high_success) %>%
  summarise(
    avg_characters = mean(total_characters),
    pct_avengers = mean(has_avengers) * 100,
    avg_comics = mean(comic_count)
  )

insights
```

```{r}
final_data %>%
  mutate(many_characters = total_characters >= 20) %>%
  group_by(many_characters) %>%
  summarise(
    success_rate = mean(high_success == "Yes") * 100,
    count = n()
  )
```














